(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{1462:function(e,t,n){"use strict";n.d(t,"a",(function(){return xe})),n.d(t,"b",(function(){return Me}));var i,r=n(449),o=n.n(r),a=n(27),c=n.n(a),s=n(29),u=n.n(s),d=n(19),l=n.n(d),h=n(37),f=n.n(h),b=n(152),v=n.n(b),g=n(25),p=n.n(g),m=n(34),j=n.n(m),O=n(56),y=n.n(O),k=n(23),x=n.n(k),R=n(28),T=n.n(R),M=n(1),w=n(0),C=n.n(w),B=n(3),D=n.n(B),S=n(59),E=n.n(S),L=n(58),P=n(93),V=n(40),I=n(257),_=n.n(I),A=n(113),z=n.n(A),W=n(8),F=n(1032),U=n.n(F),K=n(2022),G=["children"],N=["isDummy","loaded"];function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=l()(e);if(t){var r=l()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return u()(this,n)}}var H={init:null,rangeChange:null,currentTimeChange:null,play:null},X=function(){function e(t,n,i){x()(this,e);var r=i.config,o=r.minTime,a=r.defaultStart,c=r.defaultEnd;this.manager=i,this.minTime=o,this.minRange=0,this._start=a,this._end=c,this._toLeft=0,this._toRight=null,this.videoEle=null,this.trackWidth=0,this.duration=0,this._currentTime=0,this._currentDistance=0,this.dummyPointer=null,this.initInfo(t,n)}return T()(e,[{key:"start",get:function(){return this._start},set:function(e){this._start=e,this._toLeft=this.timeToDistance(e),this.dispatch("rangeChange")}},{key:"end",get:function(){return this._end},set:function(e){this._end=e,this._toRight=this.trackWidth-this.timeToDistance(e),this.dispatch("rangeChange")}},{key:"toLeft",get:function(){return this._toLeft},set:function(e){this._toLeft=e,this._start=this.distanceToTime(e),this.dispatch("rangeChange")}},{key:"toRight",get:function(){return this._toRight},set:function(e){this._toRight=e,this._end=this.duration-this.distanceToTime(e),this.dispatch("rangeChange")}},{key:"currentTime",get:function(){return this._currentTime},set:function(e){this._currentTime=e,this._currentDistance=this.timeToDistance(e),this.dispatch("currentTimeChange")}},{key:"currentDistance",get:function(){return this._currentDistance},set:function(e){this._currentDistance=e,this._currentTime=this.distanceToTime(e),this.dispatch("currentTimeChange")}},{key:"dispatch",value:function(e){this.manager.dispatch(e,this)}},{key:"setRange",value:function(e,t){this.toLeft===e&&this.toRight===t||(this._toLeft=e,this._toRight=t,this._start=this.distanceToTime(e),this._end=this.duration-this.distanceToTime(t),this.dispatch("rangeChange"))}},{key:"setTime",value:function(e,t){this._start=e,this._end=t,this._toLeft=this.timeToDistance(e),this._toRight=this.trackWidth-this.timeToDistance(t),this.dispatch("rangeChange")}},{key:"initInfo",value:function(e,t){this.trackWidth=t.clientWidth,this.duration=e.duration,this.minRange=this.timeToDistance(this.minTime),this.setTime(this._start,this._end||this.duration),this.currentTime=this.start}},{key:"distanceToTime",value:function(e){return this.duration*(e/this.trackWidth)}},{key:"timeToDistance",value:function(e){return this.trackWidth*(e/this.duration)}},{key:"toStart",value:function(){this.currentTime=this.start}},{key:"toEnd",value:function(){this.currentTime=this.end}},{key:"moveSelector",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"l",i=this.toLeft+e,r=this.toRight-t,o=e===t;if(!o||!(i<0&&r>0||i>0&&r<0)){var a=Math.max(i,0),c=Math.max(r,0);if(this.dummyPointer||(this.dummyPointer={time:this.currentTime,distance:this.currentDistance}),(0!==a||0!==c)&&Math.abs(e)<=2&&Math.abs(t)<=2){var s=this.dummyPointer.distance-a,u=this.trackWidth-c-this.dummyPointer.distance;Math.abs(s)<=4&&0!==e&&(a=Math.max(a+s,0),o&&(c=Math.max(c-s,0)),n="l"),Math.abs(u)<=4&&0!==t&&(c=Math.max(c+u,0),o&&(a=Math.max(a-u,0)),n="r")}var d=this.trackWidth-a-c,l=d-this.minRange;l<-.001&&(this.manager.onMinRange(),n&&"l"!==n?c=this.trackWidth-this.minRange-a:a=this.trackWidth-this.minRange-c),this.setRange(a,c),0!==e?this.toStart():this.toEnd()}}},{key:"moveSelectorByKey",value:function(e,t){var n=this.start,i=this.end;"l"===t?((!e||"l"===e)&&(n-=1),(!e||"r"===e)&&(i-=1)):((!e||"l"===e)&&(n+=1),(!e||"r"===e)&&(i+=1)),this.changeTime(n,i)}},{key:"movePointer",value:function(e){var t=this.currentDistance+e;t>=this.toLeft&&t<=this.trackWidth-this.toRight&&(this.currentDistance=t)}},{key:"movePointerByKey",value:function(e){var t=this.currentTime+("l"===e?-1:1);this.currentTime=Math.min(Math.max(0,t),this.duration)}},{key:"changeTime",value:function(e,t){if(void 0!==t){var n=Math.max(e,0),i=Math.min(t,this.duration);if(i-n<this.minTime&&(i=n+this.minTime),i>this.duration){var r=i-this.duration;n-=r,i-=r}this.setTime(n,i),this.currentTime=n}else this.currentTime=e}},{key:"autoSeekNext",value:function(e){e=Math.max(e,this.minTime);var t=this.end,n=this.duration;n-t<e&&(t=this.duration-e,n=this.duration),this.setTime(t,n),this.currentTime=t}}]),e}(),Y=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;x()(this,e),this.waitCache=void 0,this.unListenAll=function(){n.eventMap=null},this.dispatch=function(e,t){var i;null===(i=n.eventMap)||void 0===i||i[e].map((function(e){return e(t,n)}))},this.handleMouseDown=function(){n.isPausedBeforeMove=n.videoEle.paused,n.pauseVideo(),n.dispatch("startDrag")},this.handleMouseUp=function(){n.track.dummyPointer=null,n.dispatch("currentTimeChange",n.track),n.isPausedBeforeMove?n.seekVideo(n.track.currentTime):n.track.currentTime===n.track.end?(n.seekVideoThrottle.cancel(),n.track.toStart(),n.playVideo(n.track.start)):n.playVideo(n.track.currentTime),n.dispatch("endDrag")},this.changeRangeByTime=function(e,t){n.track?(n.pauseVideo(),n.track.changeTime(e,t),n.seekVideo(n.track.start)):n.waitCache={start:e,end:t}},this.autoNextRange=function(e){n.track.autoSeekNext(e),n.seekVideo(n.track.start)},this.seekVideo=function(e){"number"==typeof e&&(n.videoEle.currentTime=e)},this.seekVideoThrottle=_()(this.seekVideo,100,{leading:!0,trailing:!0}),this.eventMap=Object.assign({},H),this.url=t,this.config={minTime:i,defaultStart:r,defaultEnd:o},this.track=null,this.videoEle=null,this.initialized=!1,this.keyFramesCacheId=a,this.onMinRange=z()(c,100)}return T()(e,[{key:"listen",value:function(e,t,n){var i=this,r=t;n&&(r=function(n,o){i.unListen(e,r),t(n,o)}),this.eventMap[e]||(this.eventMap[e]=[]),this.eventMap[e].push(r)}},{key:"unListen",value:function(e,t){var n=this.eventMap[e].findIndex((function(e){return e===t}));if(-1!==n){var i=y()(this.eventMap[e]);i.splice(n,1),this.eventMap[e]=i}}},{key:"init",value:function(e,t){this.videoEle=e,this.track=new X(e,t,this),this.initialized=!0,this.waitCache?(this.changeRangeByTime(this.waitCache.start,this.waitCache.end),this.waitCache=null):(this.pauseVideo(),this.seekVideo(this.track.currentTime)),this.dispatch("init")}},{key:"changeRangeByMovement",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"l";0===e&&0===t||(e===t&&this.pauseVideo(),this.track.moveSelector(e,t,n),this.seekVideoThrottle(this.track.currentTime))}},{key:"changeRangeByKey",value:function(e,t){this.pauseVideo(),this.track.moveSelectorByKey(e,t),this.seekVideo(this.track.start)}},{key:"changeTimeByDistance",value:function(e){this.track.movePointer(e),this.seekVideoThrottle(this.track.currentTime)}},{key:"changeTimeByKey",value:function(e){this.track.movePointerByKey(e),this.seekVideo(this.track.currentTime)}},{key:"videoReachRangeEnd",value:function(){return this.videoEle.currentTime.toFixed(3)===this.track.end.toFixed(3)}},{key:"videoReady",value:function(){return this.videoEle.readyState>=3}},{key:"playVideo",value:function(e){if(this.seekVideo(e),this.videoEle.paused){var t=this.videoEle.play();void 0!==t&&t.catch(E.a)}}},{key:"pauseVideo",value:function(){this.videoEle.paused||this.videoEle.pause()}},{key:"toggleVideo",value:function(){this.videoEle.paused&&!this.videoReachRangeEnd()?this.videoEle.play():this.videoEle.pause()}}]),e}(),J=Object(w.createContext)(null),Q=function(){return Object(w.useContext)(J)},Z=function(e){var t=e.children,n=j()(e,G),i=Object(w.useState)((function(){var e=n.url,t=n.minTime,i=n.defaultStart,r=n.defaultEnd,o=n.keyFramesCacheId,a=n.onMinRange;return new Y(e,t/1e3,i/1e3,r/1e3,o,a)})),r=p()(i,1)[0];return Object(M.b)(J.Provider,Object.assign({value:r},{children:t}),void 0)},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.a,t=Q(),n=Object(w.useState)(t.initialized),i=p()(n,2),r=i[0],o=i[1],a=Object(V.d)(e);return Object(w.useLayoutEffect)((function(){t.listen("init",(function(){o(!0),a()}),!0)}),[t,a]),r},ee=function(e){return new Promise((function(t){var n=document.createElement("video");n.setAttribute("crossOrigin","anonymous"),n.onloadedmetadata=function(){n.onloadedmetadata=null,t(n)},n.src=e,n.volume=0}))},te=function(){var e=v()(f.a.mark((function e(t,n,i){var r,o,a,c,s,u,d,l,h,b;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t/8,o=2*window.devicePixelRatio,a=n.videoHeight/n.videoWidth,c=o*r/Math.min(a,1),s=o*r*Math.max(a,1),n.width=c,n.height=s,u=document.createElement("canvas"),d=u.getContext("2d"),u.width=c,u.height=s,l=0,h=n.duration/8,b=Date.now(),e.abrupt("return",new Promise((function(e){var t=[];n.addEventListener("seeked",(function r(){d.drawImage(n,0,0,c,s);var o=u.toDataURL("image/jpeg");if(t.push(o),i(o),7===l)return n.removeEventListener("seeked",r),e(t),void console.log("keyframe loaded: ".concat(Date.now()-b,"ms"));l++,n.currentTime=l*h})),n.currentTime=l*h})));case 15:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),ne={},ie=function(e){var t=e.url;return Object(M.b)("div",{css:{backgroundSize:"cover",backgroundPosition:"center center",width:"12.5%",userSelect:"none"},style:{backgroundImage:"url(".concat(t,")")}},void 0)},re=Object(w.forwardRef)((function(e,t){return Object(M.b)(L.Flex,Object.assign({ref:t,alignItems:"stretch",width:"100%",height:"100%",overflow:"hidden",css:{position:"absolute",top:0,left:0,borderRadius:"4px"}},e),void 0)})),oe=function(){var e=function(e){var t=Q(),n=$(),i=Object(w.useState)([]),r=p()(i,2),o=r[0],a=r[1],c=Object(V.d)((function(e){a([].concat(y()(o),[e]))}));return Object(w.useEffect)((function(){ne[t.keyFramesCacheId]?a(ne[t.keyFramesCacheId]):n&&function(){var e=v()(f.a.mark((function e(){var n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(t.url);case 2:return n=e.sent,e.next=5,te(t.track.trackWidth,n,c);case 5:i=e.sent,t.keyFramesCacheId&&(ne[t.keyFramesCacheId]=i);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[n,c,t,e]),o}();return Object(M.b)(re,Object.assign({bg:"GBK07A"},{children:e.map((function(e,t){return Object(M.b)(ie,{url:e},t)}))}),void 0)},ae=function(){var e=Object(w.useRef)(),t=Q();Object(w.useLayoutEffect)((function(){t.listen("rangeChange",(function(t){e.current.style.borderLeftWidth="".concat(t.toLeft,"px"),e.current.style.borderRightWidth="".concat(t.toRight,"px")}))}),[t]);var n=Object(V.d)((function(e){t.changeRangeByMovement(e,0,"l")})),i=Object(V.d)((function(e){t.changeRangeByMovement(0,e,"r")})),r=Object(V.d)((function(e){t.changeRangeByMovement(e,e,e>0?"l":"r")})),o=Object(V.d)((function(n){n.preventDefault(),t.track.dummyPointer=null;var i=n.pageX-e.current.getBoundingClientRect().left;t.track.currentDistance=i,t.pauseVideo(),t.seekVideo(t.track.currentTime),document.querySelector(".video-range-selector #pointer").focus()}));return{selectorRef:e,handleMouseDown:t.handleMouseDown,handleMouseUp:t.handleMouseUp,handleLeftMove:n,handleRightMove:i,selectorMove:r,rangeClick:o}},ce=function(e){c()(n,e);var t=q(n);function n(){var e;return x()(this,n),(e=t.call(this)).handleMouseDown=function(t){var n,i;t.stopPropagation(),e.canMove=!0,e.clickCaptured=!0,e.x=t.pageX,e.y=t.pageY,null===(i=(n=e.props).onMouseDown)||void 0===i||i.call(n,t)},e.handleMouseUp=function(t){var n,i,r,o;e.canMove&&(t.stopPropagation(),e.props.captureClick&&e.clickCaptured&&(e.clickCaptured=!1,null===(i=(n=e.props).onClick)||void 0===i||i.call(n,t)),t.defaultPrevented||(e.canMove=!1,null===(o=(r=e.props).onMouseUp)||void 0===o||o.call(r,t)),e.canMove=!1)},e.handleMouseMove=function(t){var n,i;t.stopPropagation(),e.clickCaptured=!1,e.canMove&&(null===(i=(n=e.props).onMove)||void 0===i||i.call(n,t.pageX-e.x,t.pageY-e.y),e.x=t.pageX,e.y=t.pageY)},e.canMove=!1,e}return T()(n,[{key:"render",value:function(){return Object(w.cloneElement)(this.props.children,{onMouseDown:this.handleMouseDown,onMouseLeave:this.handleMouseUp,onMouseUp:this.handleMouseUp,onMouseMove:this.handleMouseMove})}}]),n}(w.Component),se={position:"absolute",top:-2,width:7,height:"calc(100% + 4px)",cursor:"col-resize",userSelect:"none",outline:"none","&:active":{padding:"0 50px !important",zIndex:1},"&:first-of-type":{left:-15,paddingLeft:8,div:{borderTopLeftRadius:6,borderBottomLeftRadius:6},"&:active":{left:-57}},"&:last-of-type":{right:-15,paddingRight:8,div:{borderTopRightRadius:6,borderBottomRightRadius:6},"&:active":{right:-57}}},ue=function(e){return{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none",background:e.colors.GBL01A,"&::before":{display:"block",content:'""',width:1,height:15,background:"rgba(243, 243, 243, .5)"}}},de=Object(w.forwardRef)((function(e,t){var n=e.id,i=e.onMove,r=e.onMouseDown,o=e.onMouseUp;return Object(M.b)(ce,Object.assign({onMove:i,onMouseDown:r,onMouseUp:o},{children:Object(M.b)("div",Object.assign({id:n,css:se,tabIndex:-1},{children:Object(M.b)("div",{ref:t,css:ue},void 0)}),void 0)}),void 0)})),le=function(e){var t=e.colors;return{display:"flex",alignItems:"stretch",justifyContent:"stretch",position:"absolute",left:-2,right:-2,top:-2,bottom:-2,border:"2px solid ".concat(t.GBL01A),borderRadius:6,cursor:"grab",userSelect:"none",outline:"none","&:active":{cursor:"grabbing"},"&::before, &::after":{content:"''",position:"absolute",width:"100%",height:2,background:t.GBL01A},"&::before":{top:-2},"&::after":{bottom:-2}}},he=Object(w.memo)((function(){var e=$(),t=ae(),n=t.selectorRef,i=t.handleMouseDown,r=t.handleMouseUp,o=t.handleLeftMove,a=t.handleRightMove,c=t.selectorMove,s=t.rangeClick;return Object(M.b)(re,Object.assign({ref:n,css:{boxSizing:"border-box",borderColor:"rgba(0, 0, 0, 0.6)",borderStyle:"solid",borderWidth:"0",borderRadius:"4px",overflow:"visible",borderLeftWidth:0,borderRightWidth:0},style:{display:e?"block":"none"}},{children:Object(M.b)(ce,Object.assign({captureClick:!0,onMove:c,onMouseDown:i,onMouseUp:r,onClick:s},{children:Object(M.c)("div",Object.assign({id:"selector",css:le,tabIndex:-1},{children:[Object(M.b)(de,{id:"left-handle",onMove:o,onMouseDown:i,onMouseUp:r},void 0),Object(M.b)(de,{id:"right-handle",onMove:a,onMouseDown:i,onMouseUp:r},void 0)]}),void 0)}),void 0)}),void 0)}));he.defaultProps={manager:D.a.instanceOf(Y)};var fe=Object(W.h)(i||(i=o()(["\n  0%, 100% {transform: scale(1.0);}\n  50% {transform: scale(1.15);}\n"]))),be=Object(w.forwardRef)((function(e,t){var n=e.isDummy,i=e.loaded,r=j()(e,N);return Object(M.b)("div",Object.assign({ref:t,id:"pointer",css:function(e){var t=e.colors;return{zIndex:1,position:"absolute",height:"115%",top:"50%",left:0,transform:"translateX(-50%) translateY(-50%)",userSelect:"none",outline:"none",cursor:n?"auto":"col-resize",pointerEvents:n?"none":"auto",div:{boxShadow:"0px 0px 3px rgba(0, 0, 0, 0.4)"},"&[attached] div":{borderColor:t.GBL01A,animation:"".concat(fe," .2s ease-in-out forwards")}}},style:{display:i&&!n?"block":"none"}},!n&&{tabIndex:-1},r,{children:n?Object(M.b)(L.Box,{height:"100%",css:function(e){var t=e.colors;return{pointerEvents:"none",border:"0 dashed ".concat(t.GBK99B),borderLeftWidth:1,borderRightWidth:1,backdropFilter:"contrast(.7)"}}},void 0):Object(M.b)(L.Box,{bg:"GBL01A",height:"100%",width:"4px",css:function(e){return{display:"block",borderRadius:4,"&:active":{margin:"0 50px"},border:"solid 1px ".concat(e.colors.GBK99A)}}},void 0)}),void 0)})),ve=Object(w.memo)((function(){var e=$(),t=function(){var e=Q(),t=Object(w.useRef)(),n=Object(w.useRef)();Object(w.useLayoutEffect)((function(){e.listen("startDrag",(function(){t.current.style.pointerEvents="none"})),e.listen("endDrag",(function(){t.current.style.pointerEvents="auto"})),e.listen("currentTimeChange",(function(e){t.current.style.left="".concat(e.currentDistance,"px"),e.dummyPointer?(n.current.style.display="block",n.current.style.left="".concat(e.dummyPointer.distance,"px"),Math.abs(e.dummyPointer.time-e.currentTime)<.001?n.current.setAttribute("attached",1):n.current.removeAttribute("attached")):(n.current.style.display="none",n.current.removeAttribute("attached"))}))}),[e]);var i=Object(V.d)((function(t){e.changeTimeByDistance(t)})),r=Object(V.d)((function(){e.pauseVideo()})),o=Object(V.d)((function(){e.seekVideo(e.track.currentTime)}));return{pointerRef:t,dummyPointerRef:n,handleMove:i,handleMouseDown:r,handleMouseUp:o}}(),n=t.pointerRef,i=t.dummyPointerRef,r=t.handleMove,o=t.handleMouseDown,a=t.handleMouseUp;return Object(M.c)(M.a,{children:[Object(M.b)(ce,Object.assign({onMove:r,onMouseDown:o,onMouseUp:a},{children:Object(M.b)(be,{ref:n,loaded:e},void 0)}),void 0),Object(M.b)(be,{ref:i,isDummy:!0,loaded:e},void 0)]},void 0)}));function ge(e){var t=Math.floor(e/60),n=Math.floor(e%60);return"".concat(String(t),":").concat(U()(String(n),2,"0"))}var pe=function(){var e=Object(w.useState)({start:0,end:0}),t=p()(e,2),n=t[0],i=t[1],r=$(),o=Q();return Object(w.useEffect)((function(){o.listen("rangeChange",(function(e){i({start:e.start,end:e.end})}))}),[o]),Object(M.c)(L.Flex,Object.assign({alignItems:"center",justifyContent:"space-between",mt:10},{children:[Object(M.b)(L.Text,Object.assign({fontSize:"12px",lineHeight:1.25,color:"GBK02A"},{children:"选择视频片段投稿到问题"}),void 0),r&&Object(M.c)(L.Text,Object.assign({fontSize:"15px",fontWeight:"bold",color:"GBL01A"},{children:[ge(n.start),"-",ge(n.end)]}),void 0)]}),void 0)},me=Object(w.forwardRef)((function(e,t){var n=e.hide,i=Object(P.f)().colors.GBL01A;return Object(M.c)(L.Flex,Object.assign({flexDirection:"column",justifyContent:"stretch",bg:"GBL01A",p:"20px",pb:"16px",css:{position:"relative",background:Object(P.b)(i).alpha(.08)},style:{display:n?"none":"flex"}},{children:[Object(M.c)(L.Box,Object.assign({ref:t,width:"100%",css:{position:"relative","&:after":{display:"block",content:'""',paddingBottom:"12.5%"}}},{children:[Object(M.b)(oe,{},void 0),Object(M.b)(he,{},void 0),Object(M.b)(ve,{},void 0)]}),void 0),Object(M.b)(pe,{},void 0)]}),void 0)}));me.defaultProps={manager:D.a.instanceOf(Y)};var je=Object(w.forwardRef)((function(e,t){var n=e.onLoadedMetadata,i=e.className,r=function(e){var t=Q(),n=Object(w.useState)(!1),i=p()(n,2),r=i[0],o=i[1],a=Object(w.useRef)(),c=Object(V.d)((function(){var n=e.current;a.current=!0;!function e(){return requestAnimationFrame((function(){var i=t.track;if(i.currentTime>i.end)return t.pauseVideo(),i.currentTime=i.end,void(a.current=!1);i.currentTime=n.currentTime,a.current&&e()}))}()})),s=Object(V.d)((function(){o(!0),c()})),u=Object(V.d)((function(){o(!1),a.current=!1})),d=Object(V.d)((function(){r?t.pauseVideo():t.videoReady()&&!t.videoReachRangeEnd()&&t.playVideo()}));return{isPlaying:r,handlePlay:s,handlePause:u,handleBtnClick:d}}(t),o=r.isPlaying,a=r.handlePlay,c=r.handlePause,s=r.handleBtnClick;return Object(M.c)(L.Box,Object.assign({mx:"20px",mb:"20px",css:{position:"relative","&:after":{display:"block",content:'""',paddingBottom:"56.25%"}},className:i},{children:[Object(M.b)("video",{ref:t,css:function(e){return{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:8,background:e.colors.GBK02B}},autoPlay:!1,onLoadedMetadata:n,onPlay:a,onPause:c},void 0),Object(M.b)(L.Box,Object.assign({width:"100%",height:"100%",css:{position:"absolute",top:0,left:0,borderRadius:8,cursor:"pointer",transition:"opacity ease-in-out .3s",background:"rgba(0, 0, 0, .04)"},onClick:s,style:{opacity:o?0:1}},{children:Object(M.b)(L.Flex,Object.assign({alignItems:"center",justifyContent:"center",bg:"GBK99B",width:54,height:54,css:{position:"absolute",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",borderRadius:"50%",boxShadow:"0 0 4px rgba(0, 0, 0, .16)",opacity:.95,"&:active div":{opacity:.8}}},{children:Object(M.b)(K.a,{color:"GBK02B",size:24},void 0)}),void 0)}),void 0)]}),void 0)})),Oe=function(){var e=Q(),t=$();return Object(V.d)((function(n){if(t){var i=document.querySelector(".video-range-selector");if(" "===n.key)e.toggleVideo();else if("ArrowLeft"===n.key||"ArrowRight"===n.key){var r="ArrowLeft"===n.key?"l":"r";switch(document.activeElement){case i.querySelector("#left-handle"):return void e.changeRangeByKey("l",r);case i.querySelector("#right-handle"):return void e.changeRangeByKey("r",r);case i.querySelector("#selector"):return void e.changeRangeByKey(null,r);case i.querySelector("#pointer"):default:return void e.changeTimeByKey(r)}}}}))},ye=function(e,t){var n=Q();Object(w.useEffect)((function(){if(window.ResizeObserver){var i=!0,r=new ResizeObserver(z()((function(){i?i=!1:e.current&&t.current&&(n.config.defaultStart=n.track.start,n.config.defaultEnd=n.track.end,n.init(e.current,t.current))}),200));return n.listen("init",(function(){return r.observe(e.current)}),!0),function(){return r.disconnect()}}}),[e,t,n])},ke=Object(w.forwardRef)((function(e,t){var n=e.hideTrack,i=e.onRangeChange,r=Q(),o=Object(w.useRef)(),a=Object(w.useRef)(),c=Oe();ye(o,a);var s=Object(V.d)(i);Object(w.useLayoutEffect)((function(){return o.current.src=r.url,r.listen("rangeChange",(function(e){var t=Math.floor(1e3*e.start),n=Math.floor(1e3*e.end);s(t,n)})),r.unListenAll}),[r,s]),Object(w.useImperativeHandle)(t,(function(){return{getDuration:function(){return Math.floor(1e3*r.track.duration)},changeRange:function(e,t){return r.changeRangeByTime(e/1e3,t/1e3)},autoNextRange:function(e){return r.autoNextRange(e/1e3)}}}));var u=Object(V.d)((function(){r.init(o.current,a.current)}));return Object(M.c)(L.Box,Object.assign({tabIndex:-1,className:"video-range-selector",css:{outline:"none"},onKeyDown:c},{children:[Object(M.b)(je,{ref:o,onLoadedMetadata:u},void 0),Object(M.b)(me,{ref:a,hide:n},void 0)]}),void 0)})),xe=Object(w.forwardRef)((function(e,t){return Object(M.b)(Z,Object.assign({},e,{children:Object(M.b)(ke,Object.assign({ref:t},e),void 0)}),void 0)}));xe.propTypes={url:D.a.string.isRequired,minTime:D.a.number,defaultStart:D.a.number,defaultEnd:D.a.number,hideTrack:D.a.bool,keyFramesCacheId:D.a.string,onMinRange:D.a.func,onRangeChange:D.a.func,refProp:D.a.shape({getDuration:D.a.func,changeRange:D.a.func,autoNextRange:D.a.func})},xe.defaultProps={minTime:6e4,defaultStart:0,defaultEnd:null,hideTrack:!1,onMinRange:E.a,onRangeChange:E.a};var Re=C.a.forwardRef((function(e,t){var n=e.hide,i=ae(),r=i.selectorRef,o=i.rangeClick;return Object(M.b)(L.Flex,Object.assign({flexDirection:"column",justifyContent:"stretch",pb:"16px",mt:"23px",css:{position:"relative"},style:{display:n?"none":"flex",borderRadius:"4px"}},{children:Object(M.c)(L.Box,Object.assign({ref:t,width:"100%",css:{position:"relative","&:after":{display:"block",content:'""',paddingBottom:"12.5%"}}},{children:[Object(M.c)(L.Box,Object.assign({ref:r,onClick:o,css:{cursor:"pointer"}},{children:[" ",Object(M.b)(oe,{},void 0)]}),void 0),Object(M.b)(ve,{},void 0)]}),void 0)}),void 0)}));Re.defaultProps={manager:D.a.instanceOf(Y)};var Te=C.a.forwardRef((function(e,t){var n=e.onTimeUpdate,i=e.onInit,r=Q(),o=Object(w.useRef)(),a=Object(w.useRef)(),c=Oe();ye(o,a);var s=Object(V.d)(n),u=Object(V.d)(i);Object(w.useLayoutEffect)((function(){return o.current.src=r.url,r.listen("currentTimeChange",(function(){r.track&&s(r.track.currentTime)})),r.listen("init",(function(){u()})),r.unListenAll}),[r,s,u]),Object(w.useImperativeHandle)(t,(function(){return{getDuration:function(){return r.track.duration},setTime:function(e){r.track.currentTime=e,r.pauseVideo(),r.seekVideo(r.track.currentTime)},getTime:function(){return r.track.currentTime},pauseVideo:function(){return r.pauseVideo()}}}));var d=Object(V.d)((function(){r.init(o.current,a.current)}));return Object(M.c)(L.Box,Object.assign({tabIndex:-1,className:"video-range-selector",css:{outline:"none"},onKeyDown:c},{children:[Object(M.b)(je,{css:{margin:0},ref:o,onLoadedMetadata:d},void 0),Object(M.b)(Re,{ref:a},void 0)]}),void 0)})),Me=C.a.forwardRef((function(e,t){return Object(M.b)(Z,Object.assign({},e,{children:Object(M.b)(Te,Object.assign({ref:t},e),void 0)}),void 0)}));Me.propTypes={videoTime:D.a.number,url:D.a.string.isRequired,minTime:D.a.number,defaultStart:D.a.number,defaultEnd:D.a.number,hideTrack:D.a.bool,keyFramesCacheId:D.a.string,onMinRange:D.a.func,onRangeChange:D.a.func,refProp:D.a.shape({getDuration:D.a.func,changeRange:D.a.func,autoNextRange:D.a.func})},Me.defaultProps={minTime:6e4,defaultStart:0,defaultEnd:null,hideTrack:!1,onInit:E.a,onTimeUpdate:E.a,videoTime:0,onMinRange:E.a,onRangeChange:E.a}},2903:function(e,t,n){"use strict";n.r(t);var i=n(47),r=n(1),o=n(0),a=n.n(o),c=n(21),s=n(58),u=n(59),d=n.n(u),l=n(72),h=n(171),f=n(33),b=n(96),v=n(40),g=n(458),p=n(31),m=n(1770),j=n(1653),O=n(32),y=n(1462),k=n(113),x=n.n(k),R=n(315),T=["defaultVideo","onRangeChange"],M=Object(R.a)("VideoRangeEditor"),w=function(e,t){var n=e.defaultVideo,a=e.onRangeChange,s=Object(O.default)(e,T),u=Object(c.useDispatch)(),d=Object(o.useState)((function(){var e;if(null!=n&&n.file)return URL.createObjectURL(n.file);if(null!=n&&null!==(e=n.video)&&void 0!==e&&e.playlist){var t=n.video.playlist,i=t.sd,r=t.ld,o=t.hd,a=t.fhd;return(i||r||o||a).playUrl}})),l=Object(i.a)(d,1)[0],h=Object(v.d)(x()((function(e,t){M(e,t),a(e,t)}),200)),f=Object(v.d)((function(){u(Object(p.h)("片段最小时长需要 1 分钟哦～"))}));if(l)return Object(r.b)(y.a,Object.assign({keyFramesCacheId:n.id,ref:t,url:l,onRangeChange:h,onMinRange:f},s))},C=a.a.forwardRef(w),B=n(1508),D=function(e,t,n){var i=function(e){return Math.floor(e/1e3)};return t.some((function(t){var r=t.id,o=t.startTime,a=t.endTime;return r!==n&&i(o)===i(e.start)&&i(a)===i(e.end)}))};t.default=function(e){var t=e.defaultVideo,n=e.title,a=e.description,u=e.duration,O=e.show,y=e.onClose,k=e.closeAfterEdit,x=void 0!==k&&k,R=e.shouldPublish,T=void 0!==R&&R,M=Object(c.useDispatch)(),w=t.id,S=Object(g.o)(w).answer,E=(S=void 0===S?{}:S).totalCount,L=void 0===E?0:E,P=Object(g.r)(),V=Boolean(P),I=Object(g.p)(w),_=!V&&I.length===L,A=Object(o.useRef)(),z=Object(o.useState)({start:0,end:0}),W=Object(i.a)(z,2),F=W[0],U=W[1],K=Object(o.useState)(null),G=Object(i.a)(K,2),N=G[0],q=G[1],H=Object(o.useState)(""),X=Object(i.a)(H,2),Y=X[0],J=X[1],Q=!N&&T,Z=Object(l.i)(),$=Object(o.useCallback)((function(e,t){U({start:e,end:t})}),[]),ee=Object(o.useCallback)((function(){q(null),J(""),M(Object(g.l)(null))}),[M]),te=Object(o.useCallback)((function(){var e=D(F,I,null==P?void 0:P.id);return e&&M(Object(p.h)("该视频片段已投稿其他问题")),e}),[F,I,P,M]),ne=Object(v.d)((function(){Z.trackEvent({eventType:"Click",action:"Close",block:"Modal",elementLocation:{type:"Button"}}),N&&Y?h.a.confirm(Object(r.b)(s.Box,{textAlign:"center",children:"当前视频投稿内容离开后不保存"}),{title:Object(r.b)(s.Box,{ml:"23px",children:"取消当前视频投稿编辑吗？"}),text:{ok:"继续编辑",cancel:"取消离开"}}).then(d.a,y):y()})),ie=Object(v.d)((function(){T?M(Object(g.k)(w)).then((function(){M(Object(p.h)("投稿成功，审核后自动发布")),y()})):y()})),re=Object(o.useCallback)((function(e){te()||q(e)}),[te]),oe=Object(v.d)((function(){var e={startTime:F.start,endTime:F.end,content:Y};te()||(V?M(Object(g.n)(P.id,e)).then((function(){var e;x?y():(ee(),null===(e=A.current)||void 0===e||e.changeRange(0,A.current.getDuration()))})):M(Object(g.a)(w,Object.assign(Object.assign({},e),{},{target:{parentObject:{type:"question",id:N.id,title:N.title},object:{type:"answer"}}}),u)).then((function(){var e;ee(),null===(e=A.current)||void 0===e||e.autoNextRange(6e4)})))})),ae=Object(v.d)((function(){V&&x?y():ee()}));return Object(o.useEffect)((function(){if(O)if(P){var e,t=P.target.parentObject,n=P.content,i=P.startTime,r=P.endTime;q(t),J(n),null===(e=A.current)||void 0===e||e.changeRange(i,r)}else ee()}),[O,P,M,ee]),Object(r.b)(b.b,{maskClosable:!1,onClose:ne,css:{width:"916px",maxHeight:"initial",".Modal-content":{lineHeight:"normal",padding:0,margin:0}},children:O&&Object(r.b)(l.b,{block:"Modal",children:Object(r.c)(l.e,{zaType:"Block",as:s.Flex,height:"600px",children:[Object(r.c)(s.Flex,{flexDirection:"column",width:"395px",height:"100%",css:function(e){return{borderRight:"1px solid ".concat(e.colors.GBK09A)}},children:[Object(r.b)(s.Box,{fontSize:"24px",fontWeight:"500",px:"20px",my:"24px",children:V?"修改已有投稿":"添加新的投稿"}),Object(r.b)(C,{ref:A,defaultVideo:t,onRangeChange:$,hideTrack:_}),Object(r.b)(s.Box,{flex:"1",overflowY:"auto",px:"20px",children:Boolean(I.length)&&Object(r.c)(r.a,{children:[Object(r.b)(s.Box,{fontWeight:"500",color:"GBK03A",mt:"20px",mb:"10px",children:"已添加投稿"}),Object(r.b)(B.a,{zvideoId:w,showSelect:!0})]})}),Q&&Object(r.c)(s.Flex,{alignItems:"center",justifyContent:"space-between",px:"20px",height:"82px",css:{button:{width:"162px"}},children:[Object(r.b)(l.a,{zaType:"Button",zaAction:"Close",zaText:!0,as:f.c,onClick:y,children:"取消"}),Object(r.b)(l.a,{zaType:"Button",zaAction:"Save",zaText:!0,as:f.c,onClick:ie,preset:"primary",color:"blue",disabled:!I.length,children:"完成"})]})]}),Object(r.b)(s.Flex,{flexDirection:"column",flex:"1",children:_?Object(r.c)(r.a,{children:[Object(r.b)(s.Box,{px:"20px",my:"24px",fontSize:"24px",fontWeight:"500",children:"选择投稿问题"}),Object(r.c)(s.Flex,{flexDirection:"column",justifyContent:"center",alignItems:"center",flex:"1",children:[Object(r.b)(s.Image,{width:"160px",height:"160px",src:"https://pic3.zhimg.com/v2-aee0d50112db6c845a1b7e7bcd2d7a84.png"}),Object(r.b)(s.Box,{mt:"10px",fontWeight:"500",fontSize:"17px",children:"已达到投稿数量上限"}),Object(r.b)(s.Box,{mt:"4px",fontSize:"14px",color:"GBK06A",children:"可移除已添加投稿来继续投稿问题"})]})]}):N?Object(r.b)(j.a,{value:Y,onChange:J,onSubmit:oe,onCancel:ae,isEditing:V,selectedQuestion:N}):Object(r.b)(m.a,{zvideoId:w,title:n,description:a,onSelect:re})})]})})})}}}]);
//# sourceMappingURL=main.contribution-modal.abda9799362ac039a295.js.map